<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Job Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
  <div class="dashboard">
    <div class="menu-squares">
      <div class="menu-square orange-gradient" id="shifts-square">
        <span>Shifts</span>
      </div>
      <div class="menu-square blue-gradient" id="announcements-square">
        <span>Announcements</span>
      </div>
      <div class="menu-square green-gradient" id="hire-square">
        <span>Apply for Hire</span>
      </div>
      <div class="menu-square purple-gradient" id="admin-square">
        <span>Admin</span>
      </div>
      <div class="menu-square calendar-gradient" id="calendar-square">
        <span>Calendar</span>
      </div>
    </div>

    <!-- Calendar Section -->
    <div class="details-section hidden" id="calendar-details">
      <h2>Weekly Calendar</h2>
      <div class="calendar-toolbar">
        <button id="calendar-today-btn">Today</button>
        <span class="calendar-week-label" id="calendar-week-label"></span>
        <button id="calendar-prev-btn">&#8592;</button>
        <button id="calendar-next-btn">&#8594;</button>
      </div>
      <div class="calendar-container" id="calendar-container">
        <div class="calendar-grid" id="calendar-grid"></div>
      </div>
    </div>

    <!-- Shifts Section -->
    <div class="details-section hidden" id="shifts-details">
      <h2>Shifts</h2>
      <div class="shift-squares" id="shift-squares"></div>
      <div class="profile-details" id="profile-details">
        <h3>Click a profile to see shift details</h3>
      </div>
    </div>

    <!-- Announcements Section -->
    <div class="details-section hidden" id="announcements-details">
      <h2>Announcements</h2>
      <ul class="announcements-list" id="announcements-list"></ul>
    </div>

    <!-- Hire Section -->
    <div class="details-section hidden" id="hire-details">
      <h2>Apply for Hire</h2>
      <form class="hire-form" id="hire-form">
        <label>
          1. Full Name:
          <input type="text" name="name" required autocomplete="name">
        </label>
        <label>
          2. Email Address:
          <input type="email" name="email" required autocomplete="email">
        </label>
        <label>
          3. Phone Number:
          <input type="text" name="phone" required autocomplete="tel">
        </label>
        <label>
          4. Why do you want this job?
          <textarea name="why" rows="2" required></textarea>
        </label>
        <label>
          5. What relevant experience do you have?
          <textarea name="experience" rows="2" required></textarea>
        </label>
        <label>
          6. What are your strengths?
          <textarea name="strengths" rows="2" required></textarea>
        </label>
        <label>
          7. What are your weaknesses?
          <textarea name="weaknesses" rows="2" required></textarea>
        </label>
        <label>
          8. What is your availability (days and times)?
          <input type="text" name="availability" required>
        </label>
        <label>
          9. Which shift would you prefer?
          <select name="shift" required>
            <option value="">Select...</option>
            <option>Morning (6am-2pm)</option>
            <option>Day (9am-5pm)</option>
            <option>Evening (1pm-9pm)</option>
          </select>
        </label>
        <label>
          10. Are you willing to work weekends?
          <select name="weekends" required>
            <option value="">Select...</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
            <option value="maybe">Maybe</option>
          </select>
        </label>
        <label>
          11. Tell us about a time you overcame a challenge:
          <textarea name="challenge" rows="2" required></textarea>
        </label>
        <label>
          12. Emergency Contact Name & Number:
          <input type="text" name="emergency" required>
        </label>
        <button type="submit">Submit Application</button>
        <div class="form-message" id="form-message"></div>
      </form>
    </div>

    <!-- Admin Section -->
    <div class="details-section hidden" id="admin-details">
      <h2>Admin Access</h2>
      <div id="admin-login">
        <label>
          Enter admin code:
          <input type="password" id="admin-code" maxlength="32">
        </label>
        <button id="admin-login-btn">Login</button>
        <div id="admin-login-message" style="color: #b32d2d; margin-top: 8px;"></div>
      </div>
      <div id="admin-panel" class="hidden">
        <div class="admin-section">
          <h3>Change Admin Code</h3>
          <label>
            New admin code:
            <input type="password" id="new-admin-code">
          </label>
          <button id="change-admin-code-btn">Change Code</button>
          <div id="admin-code-message" style="margin-top:8px;"></div>
        </div>
        <div class="admin-section">
          <h3>Manage Workers</h3>
          <div id="admin-workers-list"></div>
          <button id="add-worker-btn">Add Worker</button>
          <div id="add-worker-form" class="hidden">
            <label>Name: <input type="text" id="new-worker-name"></label>
            <label>Shift: <input type="text" id="new-worker-shift"></label>
            <label>Tasks (comma separated): <input type="text" id="new-worker-tasks"></label>
            <button id="save-new-worker-btn">Save Worker</button>
            <button id="cancel-new-worker-btn">Cancel</button>
          </div>
        </div>
        <div class="admin-section">
          <h3>Manage Announcements</h3>
          <ul id="admin-announcements-list"></ul>
          <input type="text" id="admin-new-announcement" placeholder="Add announcement">
          <button id="admin-add-announcement-btn">Add</button>
        </div>
        <div class="admin-section">
          <h3>Manage Calendar</h3>
          <div id="admin-calendar-list"></div>
          <form id="admin-add-calendar-form" class="admin-cal-form">
            <label>Title: <input type="text" id="admin-cal-title" required></label>
            <label>Day:
              <select id="admin-cal-day" required>
                <option value="0">Monday</option>
                <option value="1">Tuesday</option>
                <option value="2">Wednesday</option>
                <option value="3">Thursday</option>
                <option value="4">Friday</option>
                <option value="5">Saturday</option>
                <option value="6">Sunday</option>
              </select>
            </label>
            <label>Start Time:
              <input type="time" id="admin-cal-start" min="06:00" max="21:00" required>
            </label>
            <label>End Time:
              <input type="time" id="admin-cal-end" min="06:00" max="21:00" required>
            </label>
            <label>Color:
              <input type="color" id="admin-cal-color" value="#ffb347" required>
            </label>
            <button type="submit">Add Event</button>
          </form>
        </div>
        <div class="admin-section">
          <h3>Manage Submissions</h3>
          <div id="submissions-section">
            <div id="submissions-list"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // ============ Dashboard State and LocalStorage =============
    // Workers
    const defaultWorkers = [
      {
        name: "John Doe",
        shift: "9:00 AM - 5:00 PM",
        tasks: [
          "Front desk coverage from 9am-12pm",
          "Inventory check at 2pm",
          "Daily report submission by 4:30pm",
          "Assist with onboarding new employees"
        ]
      },
      {
        name: "Jane Doe",
        shift: "1:00 PM - 9:00 PM",
        tasks: [
          "Supervise afternoon crew",
          "Prepare conference room for meetings",
          "Coordinate with cleaning staff",
          "Update task board at end of shift"
        ]
      },
      {
        name: "Bob Smith",
        shift: "6:00 AM - 2:00 PM",
        tasks: [
          "Early morning inventory restock",
          "Equipment maintenance at 9am",
          "Handle supplier deliveries",
          "Submit maintenance logs by 1:30pm"
        ]
      }
    ];
    function getWorkers() {
      return JSON.parse(localStorage.getItem('workers') || JSON.stringify(defaultWorkers));
    }
    function setWorkers(workers) {
      localStorage.setItem('workers', JSON.stringify(workers));
    }

    // Announcements
    const defaultAnnouncements = [
      "Team lunch on Friday at 1pm in the main cafeteria.",
      "Reminder: Submit weekly reports by Thursday 5pm.",
      "Fire drill scheduled for next Monday at 10am."
    ];
    function getAnnouncements() {
      return JSON.parse(localStorage.getItem('announcements') || JSON.stringify(defaultAnnouncements));
    }
    function setAnnouncements(list) {
      localStorage.setItem('announcements', JSON.stringify(list));
    }

    // Admin code
    function getAdminCode() {
      return localStorage.getItem('adminCode') || "1234";
    }
    function setAdminCode(newCode) {
      localStorage.setItem('adminCode', newCode);
    }

    // Submissions
    function getSubmissions() {
      return JSON.parse(localStorage.getItem('hireSubmissions') || '[]');
    }
    function setSubmissions(subs) {
      localStorage.setItem('hireSubmissions', JSON.stringify(subs));
    }
    function saveSubmission(data) {
      const subs = getSubmissions();
      subs.push(data);
      setSubmissions(subs);
    }

    // Calendar events
    const defaultCalendarEvents = [
      { title: "John Shift", day: 0, start: 9, end: 17, color: "#ffb347" },
      { title: "Jane Shift", day: 1, start: 13, end: 21, color: "#71c7ec" },
      { title: "Bob Shift", day: 2, start: 6, end: 14, color: "#8de7b5" },
      { title: "Team Lunch", day: 4, start: 13, end: 14, color: "#c3a3fc" },
      { title: "Fire Drill", day: 0, start: 10, end: 11, color: "#ff9800" },
      { title: "Manager Meeting", day: 3, start: 15, end: 16.5, color: "#7e46c5" }
    ];
    function getCalendarEvents() {
      return JSON.parse(localStorage.getItem('calendarEvents') || JSON.stringify(defaultCalendarEvents));
    }
    function setCalendarEvents(events) {
      localStorage.setItem('calendarEvents', JSON.stringify(events));
    }

    // ============ Shifts Section ============
    function renderShiftSquares() {
      const workers = getWorkers();
      const shiftSquares = document.getElementById('shift-squares');
      shiftSquares.innerHTML = '';
      workers.forEach((worker, idx) => {
        const colors = ['orange-gradient', 'blue-gradient', 'green-gradient', 'purple-gradient'];
        const color = colors[idx % colors.length];
        const div = document.createElement('div');
        div.className = `shift-square ${color}`;
        div.innerHTML = `<span>${worker.name}</span>`;
        div.addEventListener('click', () => {
          renderProfileDetails(worker);
        });
        shiftSquares.appendChild(div);
      });
    }
    function renderProfileDetails(worker) {
      const profileDetails = document.getElementById('profile-details');
      profileDetails.innerHTML = `
        <h3>${worker.name}</h3>
        <p><strong>Shift:</strong> ${worker.shift}</p>
        <ul>
          ${worker.tasks.map(task => `<li>${task}</li>`).join('')}
        </ul>
      `;
    }

    // ============ Announcements Section ============
    function renderAnnouncements() {
      const list = getAnnouncements();
      const annList = document.getElementById('announcements-list');
      annList.innerHTML = '';
      list.forEach(a => {
        const li = document.createElement('li');
        li.textContent = a;
        annList.appendChild(li);
      });
    }

    // ============ Admin Announcements ============
    function renderAdminAnnouncements() {
      const list = getAnnouncements();
      const annList = document.getElementById('admin-announcements-list');
      annList.innerHTML = '';
      list.forEach((a, i) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span class="admin-announcement-text" contenteditable="true" data-idx="${i}">${a}</span>
          <button class="delete-announcement-btn" data-idx="${i}">Delete</button>
        `;
        annList.appendChild(li);
      });
    }

    // ============ Admin Workers ============
    function renderAdminWorkers() {
      const workers = getWorkers();
      const div = document.getElementById('admin-workers-list');
      div.innerHTML = '';
      workers.forEach((worker, idx) => {
        const workerDiv = document.createElement('div');
        workerDiv.className = "admin-worker-block";
        workerDiv.innerHTML = `
          <b>${worker.name}</b> (<span>${worker.shift}</span>)
          <button class="edit-worker-btn" data-idx="${idx}">Edit</button>
          <button class="delete-worker-btn" data-idx="${idx}">Delete</button>
          <div class="admin-worker-tasks"><ul>${worker.tasks.map(t=>`<li>${t}</li>`).join('')}</ul></div>
          <div class="edit-worker-form hidden" id="edit-worker-form-${idx}">
            <label>Name: <input type="text" value="${worker.name}" class="edit-worker-name"></label>
            <label>Shift: <input type="text" value="${worker.shift}" class="edit-worker-shift"></label>
            <label>Tasks (comma separated): <input type="text" value="${worker.tasks.join(', ')}" class="edit-worker-tasks-input"></label>
            <button class="save-edit-worker-btn" data-idx="${idx}">Save</button>
            <button class="cancel-edit-worker-btn" data-idx="${idx}">Cancel</button>
          </div>
        `;
        div.appendChild(workerDiv);
      });
    }

    // ============ Admin Submissions ============
    function renderAdminSubmissions() {
      const subs = getSubmissions();
      const list = document.getElementById('submissions-list');
      if(subs.length === 0) {
        list.innerHTML = "<em>No submissions yet.</em>";
        return;
      }
      list.innerHTML = subs.map((s, i) => `
        <div class="submission-block">
          <strong>Application #${i+1}</strong>
          <button class="delete-submission-btn" data-idx="${i}">Delete</button>
          <ul>
            <li><b>Full Name:</b> ${s.name}</li>
            <li><b>Email:</b> ${s.email}</li>
            <li><b>Phone:</b> ${s.phone}</li>
            <li><b>Why do you want this job?</b> ${s.why}</li>
            <li><b>Relevant experience:</b> ${s.experience}</li>
            <li><b>Strengths:</b> ${s.strengths}</li>
            <li><b>Weaknesses:</b> ${s.weaknesses}</li>
            <li><b>Availability:</b> ${s.availability}</li>
            <li><b>Preferred shift:</b> ${s.shift}</li>
            <li><b>Willing to work weekends:</b> ${s.weekends}</li>
            <li><b>Challenge overcome:</b> ${s.challenge}</li>
            <li><b>Emergency contact:</b> ${s.emergency}</li>
          </ul>
        </div>
      `).join("");
    }

    // ============ Hire Form ============
    document.getElementById('hire-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const data = {};
      for(const [key, value] of formData.entries()) {
        data[key] = value;
      }
      saveSubmission(data);
      document.getElementById('form-message').textContent = "Application submitted! We'll be in touch.";
      form.reset();
      setTimeout(() => {
        document.getElementById('form-message').textContent = "";
      }, 3000);
    });

    // ============ Admin Panel ==============
    document.getElementById('admin-login-btn').addEventListener('click', function() {
      const code = document.getElementById('admin-code').value;
      if(code === getAdminCode()) {
        document.getElementById('admin-login').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        renderAdminWorkers();
        renderAdminAnnouncements();
        renderAdminCalendar();
        renderAdminSubmissions();
      } else {
        document.getElementById('admin-login-message').textContent = "Incorrect code.";
      }
    });

    // Change admin code
    document.getElementById('change-admin-code-btn').addEventListener('click', function() {
      const newCode = document.getElementById('new-admin-code').value.trim();
      if(newCode.length < 3) {
        document.getElementById('admin-code-message').textContent = "Code too short (minimum 3 characters).";
        document.getElementById('admin-code-message').style.color = "#b32d2d";
        return;
      }
      setAdminCode(newCode);
      document.getElementById('admin-code-message').textContent = "Admin code changed!";
      document.getElementById('admin-code-message').style.color = "#1eae60";
      document.getElementById('new-admin-code').value = "";
      setTimeout(() => document.getElementById('admin-code-message').textContent = "", 3000);
    });

    // Add Worker
    document.getElementById('add-worker-btn').addEventListener('click', function() {
      document.getElementById('add-worker-form').classList.remove('hidden');
      document.getElementById('add-worker-btn').classList.add('hidden');
      document.getElementById('new-worker-name').value = "";
      document.getElementById('new-worker-shift').value = "";
      document.getElementById('new-worker-tasks').value = "";
    });
    document.getElementById('cancel-new-worker-btn').addEventListener('click', function() {
      document.getElementById('add-worker-form').classList.add('hidden');
      document.getElementById('add-worker-btn').classList.remove('hidden');
    });
    document.getElementById('save-new-worker-btn').addEventListener('click', function() {
      const name = document.getElementById('new-worker-name').value.trim();
      const shift = document.getElementById('new-worker-shift').value.trim();
      const tasks = document.getElementById('new-worker-tasks').value.split(',').map(t=>t.trim()).filter(Boolean);
      if(!name || !shift || tasks.length === 0) return;
      const workers = getWorkers();
      workers.push({name, shift, tasks});
      setWorkers(workers);
      renderAdminWorkers();
      renderShiftSquares();
      document.getElementById('add-worker-form').classList.add('hidden');
      document.getElementById('add-worker-btn').classList.remove('hidden');
    });

    // Edit/Delete Workers
    document.getElementById('admin-workers-list').addEventListener('click', function(e) {
      if(e.target.classList.contains('edit-worker-btn')) {
        const idx = +e.target.dataset.idx;
        document.getElementById(`edit-worker-form-${idx}`).classList.remove('hidden');
      }
      if(e.target.classList.contains('cancel-edit-worker-btn')) {
        const idx = +e.target.dataset.idx;
        document.getElementById(`edit-worker-form-${idx}`).classList.add('hidden');
      }
      if(e.target.classList.contains('save-edit-worker-btn')) {
        const idx = +e.target.dataset.idx;
        const form = document.getElementById(`edit-worker-form-${idx}`);
        const name = form.querySelector('.edit-worker-name').value.trim();
        const shift = form.querySelector('.edit-worker-shift').value.trim();
        const tasks = form.querySelector('.edit-worker-tasks-input').value.split(',').map(t=>t.trim()).filter(Boolean);
        if(!name || !shift || tasks.length === 0) return;
        const workers = getWorkers();
        workers[idx] = {name, shift, tasks};
        setWorkers(workers);
        renderAdminWorkers();
        renderShiftSquares();
      }
      if(e.target.classList.contains('delete-worker-btn')) {
        const idx = +e.target.dataset.idx;
        if(confirm("Delete this worker?")) {
          const workers = getWorkers();
          workers.splice(idx, 1);
          setWorkers(workers);
          renderAdminWorkers();
          renderShiftSquares();
        }
      }
    });

    // Admin Announcements
    document.getElementById('admin-add-announcement-btn').addEventListener('click', function() {
      const val = document.getElementById('admin-new-announcement').value.trim();
      if(!val) return;
      const list = getAnnouncements();
      list.push(val);
      setAnnouncements(list);
      document.getElementById('admin-new-announcement').value = "";
      renderAdminAnnouncements();
      renderAnnouncements();
    });
    document.getElementById('admin-announcements-list').addEventListener('click', function(e) {
      if(e.target.classList.contains('delete-announcement-btn')) {
        const idx = +e.target.dataset.idx;
        if(confirm("Delete this announcement?")) {
          const list = getAnnouncements();
          list.splice(idx, 1);
          setAnnouncements(list);
          renderAdminAnnouncements();
          renderAnnouncements();
        }
      }
    });
    document.getElementById('admin-announcements-list').addEventListener('blur', function(e) {
      if(e.target.classList.contains('admin-announcement-text')) {
        const idx = +e.target.dataset.idx;
        const list = getAnnouncements();
        list[idx] = e.target.textContent.trim();
        setAnnouncements(list);
        renderAnnouncements();
      }
    }, true);

    // Admin Submissions Delete
    document.getElementById('submissions-list').addEventListener('click', function(e) {
      if(e.target.classList.contains('delete-submission-btn')) {
        const idx = +e.target.dataset.idx;
        if(confirm("Delete this submission?")) {
          const subs = getSubmissions();
          subs.splice(idx, 1);
          setSubmissions(subs);
          renderAdminSubmissions();
        }
      }
    });

    // ============ Calendar Logic ============
    let calendarEvents = getCalendarEvents();
    const HOUR_START = 6, HOUR_END = 21;
    let weekStartDate = getMonday(new Date());

    function getMonday(d) {
      d = new Date(d);
      let day = d.getDay(), diff = d.getDate() - day + (day === 0 ? -6 : 1);
      return new Date(d.setDate(diff));
    }
    function addDays(date, days) {
      const d = new Date(date);
      d.setDate(d.getDate() + days);
      return d;
    }
    function formatWeekLabel(start) {
      const end = addDays(start, 6);
      const opts = { month: "short", day: "numeric" };
      return `${start.toLocaleDateString(undefined, opts)} - ${end.toLocaleDateString(undefined, opts)}`;
    }
    function renderCalendarGoogleStyle() {
      calendarEvents = getCalendarEvents();
      const grid = document.getElementById("calendar-grid");
      grid.innerHTML = "";

      // Header Row
      const headerRow = document.createElement("div");
      headerRow.className = "cal-row cal-header";
      headerRow.innerHTML = `<div class="cal-cell cal-time-header"></div>`;
      for (let i = 0; i < 7; i++) {
        let d = addDays(weekStartDate, i);
        const opts = { weekday: "short", month: "short", day: "numeric" };
        headerRow.innerHTML += `<div class="cal-cell cal-day-header">${d.toLocaleDateString(undefined, opts)}</div>`;
      }
      grid.appendChild(headerRow);

      // Main rows (each hour)
      for (let hour = HOUR_START; hour < HOUR_END; hour++) {
        const row = document.createElement("div");
        row.className = "cal-row";
        // Time label
        const ampm = hour === 0 ? "12am" : hour < 12 ? hour + "am" : (hour === 12 ? "12pm" : (hour - 12) + "pm");
        row.innerHTML = `<div class="cal-cell cal-time">${ampm}</div>`;
        // Day cells
        for (let day = 0; day < 7; day++) {
          row.innerHTML += `<div class="cal-cell cal-slot" data-day="${day}" data-hour="${hour}"></div>`;
        }
        grid.appendChild(row);
      }

      // Render events as Google-style blocks
      calendarEvents.forEach(ev => {
        let dayIdx = ev.day;
        let startRow = Math.floor(ev.start) - HOUR_START + 1; // +1 for header
        let endRow = Math.ceil(ev.end) - HOUR_START + 1;
        if (startRow < 1 || startRow > (HOUR_END - HOUR_START)) return;
        const gridRows = grid.querySelectorAll(".cal-row");
        const topCell = gridRows[startRow]?.querySelector(`.cal-slot[data-day="${dayIdx}"]`);
        if (!topCell) return;
        const eventDiv = document.createElement("div");
        eventDiv.className = "cal-event-block";
        eventDiv.style.background = ev.color;
        eventDiv.style.top = ((ev.start % 1) * 40) + "px";
        eventDiv.style.height = ((ev.end - ev.start) * 40 - 3) + "px";
        eventDiv.textContent = ev.title;
        topCell.style.position = "relative";
        eventDiv.style.position = "absolute";
        eventDiv.style.left = "7px";
        eventDiv.style.right = "7px";
        eventDiv.style.zIndex = 2;
        eventDiv.style.display = "flex";
        eventDiv.style.alignItems = "center";
        eventDiv.style.paddingLeft = "7px";
        topCell.appendChild(eventDiv);
      });

      document.getElementById("calendar-week-label").textContent = formatWeekLabel(weekStartDate);
    }

    // Admin Calendar Management
    function renderAdminCalendar() {
      calendarEvents = getCalendarEvents();
      const listDiv = document.getElementById('admin-calendar-list');
      listDiv.innerHTML = '';
      if (calendarEvents.length === 0) {
        listDiv.innerHTML = '<em>No events scheduled.</em>';
        return;
      }
      calendarEvents.forEach((ev, idx) => {
        const wrap = document.createElement('div');
        wrap.className = "admin-cal-event";
        wrap.style.borderLeft = `7px solid ${ev.color}`;
        wrap.innerHTML = `
          <b>${ev.title}</b>
          <span class="admin-cal-desc">(${["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][ev.day]} ${toTimeStr(ev.start)}-${toTimeStr(ev.end)})</span>
          <button class="admin-cal-edit-btn" data-idx="${idx}">Edit</button>
          <button class="admin-cal-delete-btn" data-idx="${idx}">Delete</button>
          <div class="admin-cal-edit-form hidden" id="admin-cal-edit-form-${idx}">
            <label>Title: <input type="text" value="${ev.title}" class="edit-cal-title"></label>
            <label>Day:
              <select class="edit-cal-day">
                <option value="0" ${ev.day===0?'selected':''}>Monday</option>
                <option value="1" ${ev.day===1?'selected':''}>Tuesday</option>
                <option value="2" ${ev.day===2?'selected':''}>Wednesday</option>
                <option value="3" ${ev.day===3?'selected':''}>Thursday</option>
                <option value="4" ${ev.day===4?'selected':''}>Friday</option>
                <option value="5" ${ev.day===5?'selected':''}>Saturday</option>
                <option value="6" ${ev.day===6?'selected':''}>Sunday</option>
              </select>
            </label>
            <label>Start Time:
              <input type="time" value="${fromHour(ev.start)}" class="edit-cal-start">
            </label>
            <label>End Time:
              <input type="time" value="${fromHour(ev.end)}" class="edit-cal-end">
            </label>
            <label>Color:
              <input type="color" value="${ev.color}" class="edit-cal-color">
            </label>
            <button class="save-cal-edit-btn" data-idx="${idx}">Save</button>
            <button class="cancel-cal-edit-btn" data-idx="${idx}">Cancel</button>
          </div>
        `;
        listDiv.appendChild(wrap);
      });
    }
    function toTimeStr(h) {
      let hr = Math.floor(h);
      let min = Math.round((h % 1) * 60);
      let s = hr === 0 ? "12am" : hr < 12 ? hr+"am" : hr === 12 ? "12pm" : (hr-12)+"pm";
      if(min>0) s = s.replace(/am|pm/,'') + ":" + (min<10?"0":"") + min + s.slice(-2);
      return s;
    }
    function fromHour(val) {
      let hr = Math.floor(val);
      let min = Math.round((val % 1) * 60);
      return (hr<10?"0":"") + hr + ":" + (min<10?"0":"") + min;
    }
    document.getElementById('admin-calendar-list').addEventListener('click', function(e) {
      if (e.target.classList.contains('admin-cal-edit-btn')) {
        const idx = +e.target.dataset.idx;
        document.getElementById(`admin-cal-edit-form-${idx}`).classList.remove('hidden');
      }
      if (e.target.classList.contains('cancel-cal-edit-btn')) {
        const idx = +e.target.dataset.idx;
        document.getElementById(`admin-cal-edit-form-${idx}`).classList.add('hidden');
      }
      if (e.target.classList.contains('save-cal-edit-btn')) {
        const idx = +e.target.dataset.idx;
        const form = document.getElementById(`admin-cal-edit-form-${idx}`);
        const title = form.querySelector('.edit-cal-title').value.trim();
        const day = +form.querySelector('.edit-cal-day').value;
        const start = timeToHour(form.querySelector('.edit-cal-start').value);
        const end = timeToHour(form.querySelector('.edit-cal-end').value);
        const color = form.querySelector('.edit-cal-color').value;
        if (!title || end <= start) return;
        calendarEvents = getCalendarEvents();
        calendarEvents[idx] = { title, day, start, end, color };
        setCalendarEvents(calendarEvents);
        renderAdminCalendar();
        renderCalendarGoogleStyle();
      }
      if (e.target.classList.contains('admin-cal-delete-btn')) {
        const idx = +e.target.dataset.idx;
        if (confirm("Delete this event?")) {
          calendarEvents = getCalendarEvents();
          calendarEvents.splice(idx, 1);
          setCalendarEvents(calendarEvents);
          renderAdminCalendar();
          renderCalendarGoogleStyle();
        }
      }
    });
    document.getElementById('admin-add-calendar-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const title = document.getElementById('admin-cal-title').value.trim();
      const day = +document.getElementById('admin-cal-day').value;
      const start = timeToHour(document.getElementById('admin-cal-start').value);
      const end = timeToHour(document.getElementById('admin-cal-end').value);
      const color = document.getElementById('admin-cal-color').value;
      if (!title || end <= start) return;
      calendarEvents = getCalendarEvents();
      calendarEvents.push({ title, day, start, end, color });
      setCalendarEvents(calendarEvents);
      renderAdminCalendar();
      renderCalendarGoogleStyle();
      e.target.reset();
    });
    function timeToHour(str) {
      if (!str) return 0;
      const [h, m] = str.split(':').map(Number);
      return h + m/60;
    }

    // ============ Navigation ============
    function hideAllDetails() {
      ["shifts-details", "announcements-details", "hire-details", "admin-details", "calendar-details"].forEach(id => {
        var e = document.getElementById(id);
        if(e) e.classList.add("hidden");
      });
      ["shifts-square", "announcements-square", "hire-square", "admin-square", "calendar-square"].forEach(id => {
        var e = document.getElementById(id);
        if(e) e.classList.remove("selected");
      });
    }
    document.getElementById('shifts-square').onclick = function() {
      hideAllDetails(); document.getElementById('shifts-details').classList.remove('hidden');
      this.classList.add('selected');
      renderShiftSquares();
      document.getElementById('profile-details').innerHTML = `<h3>Click a profile to see shift details</h3>`;
    };
    document.getElementById('announcements-square').onclick = function() {
      hideAllDetails(); document.getElementById('announcements-details').classList.remove('hidden');
      this.classList.add('selected');
      renderAnnouncements();
    };
    document.getElementById('hire-square').onclick = function() {
      hideAllDetails(); document.getElementById('hire-details').classList.remove('hidden');
      this.classList.add('selected');
    };
    document.getElementById('admin-square').onclick = function() {
      hideAllDetails(); document.getElementById('admin-details').classList.remove('hidden');
      this.classList.add('selected');
      document.getElementById('admin-login').classList.remove('hidden');
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('admin-login-message').textContent = '';
      document.getElementById('admin-code').value = '';
    };
    document.getElementById('calendar-square').onclick = function() {
      hideAllDetails();
      document.getElementById('calendar-details').classList.remove('hidden');
      this.classList.add('selected');
      renderCalendarGoogleStyle();
    };
    document.getElementById('calendar-today-btn').onclick = function () {
      weekStartDate = getMonday(new Date());
      renderCalendarGoogleStyle();
    };
    document.getElementById('calendar-prev-btn').onclick = function () {
      weekStartDate = addDays(weekStartDate, -7);
      renderCalendarGoogleStyle();
    };
    document.getElementById('calendar-next-btn').onclick = function () {
      weekStartDate = addDays(weekStartDate, 7);
      renderCalendarGoogleStyle();
    };

    // ============ Initial Render ============
    renderShiftSquares();
    renderAnnouncements();
  </script>
</body>
</html>
