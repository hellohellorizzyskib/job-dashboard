<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Work Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700|Roboto:400,500,700" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .dashboard {
      margin: 30px auto 0 auto;
      max-width: 1060px;
      padding: 0 16px 40px 16px;
    }
    .menu-squares {
      display: flex;
      flex-wrap: wrap;
      gap: 22px;
      justify-content: flex-start;
      margin-bottom: 32px;
    }
    .menu-square {
      width: 180px;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Montserrat', Arial, sans-serif;
      font-size: 1.18rem;
      font-weight: 700;
      border-radius: 22px;
      cursor: pointer;
      user-select: none;
      transition: box-shadow 0.18s, transform 0.13s;
      box-shadow: 0 2px 16px #8883;
      outline: none;
      border: none;
    }
    .menu-square.selected {
      outline: 3px solid #1eae60;
      transform: scale(1.05);
    }
    .orange-gradient {
      background: radial-gradient(circle at 65% 35%, #fff 70px, #ffb347 120px, #ff9800 100%);
    }
    .blue-gradient {
      background: radial-gradient(circle at 60% 30%, #fff 70px, #71c7ec 120px, #2792c3 100%);
    }
    .green-gradient {
      background: radial-gradient(circle at 40% 30%, #fff 70px, #8de7b5 120px, #1eae60 100%);
    }
    .purple-gradient {
      background: radial-gradient(circle at 65% 35%, #fff 70px, #c3a3fc 120px, #7e46c5 100%);
    }
    .calendar-gradient {
      background: radial-gradient(circle at 50% 40%, #fff 70px, #ffe082 120px, #ffca28 100%);
    }
    .profile-gradient {
      background: radial-gradient(circle at 30% 70%, #fff 70px, #b3f6ea 120px, #00bfae 100%);
    }
    .details-section {
      background: #fff;
      border-radius: 16px;
      padding: 34px 26px 24px 26px;
      box-shadow: 0 2px 18px #8882;
      margin-bottom: 32px;
      max-width: 940px;
      width: 100%;
      margin-left: auto;
      margin-right: auto;
    }
    label {
      display: block;
      margin-bottom: 9px;
      font-size: 1rem;
      font-weight: 500;
      color: #464d58;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="color"],
    input[type="time"],
    select,
    textarea {
      display: block;
      width: 100%;
      max-width: 370px;
      margin-top: 3px;
      margin-bottom: 8px;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ccd4e0;
      font-size: 1rem;
      font-family: 'Roboto', Arial, sans-serif;
      background: #fafdff;
      box-sizing: border-box;
    }
    input[type="color"] {
      padding: 0;
      width: 44px;
      height: 32px;
      border: none;
      background: transparent;
    }
    textarea {
      min-height: 44px;
      resize: vertical;
    }
    button {
      margin-top: 7px;
      padding: 9px 18px;
      border-radius: 8px;
      border: none;
      background: #1976d2;
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      font-family: 'Montserrat', Arial, sans-serif;
      cursor: pointer;
      transition: background 0.13s;
    }
    button:hover,
    button:focus {
      background: #0d4da1;
    }
    .admin-section {
      margin-bottom: 38px;
      padding-bottom: 8px;
      border-bottom: 1px solid #f0f3f8;
    }
    .admin-section:last-child { border-bottom: none; }
    .admin-worker-block,
    .admin-cal-event,
    .submission-block {
      background: #f6f9fa;
      border-radius: 9px;
      margin-bottom: 13px;
      padding: 13px 18px 10px 18px;
      box-shadow: 0 1px 7px #dbe9ee44;
    }
    .admin-cal-event { border-left: 7px solid #ffb347; }
    .admin-worker-block { border-left: 7px solid #1eae60; }
    .admin-worker-block b,
    .admin-cal-event b { color: #1976d2; }
    .shift-squares {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 18px;
    }
    .shift-square {
      min-width: 120px;
      min-height: 90px;
      padding: 17px 11px;
      border-radius: 10px;
      font-size: 1.03rem;
      font-weight: 600;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 1px 5px #8882;
      transition: box-shadow .12s;
    }
    .shift-square:hover {
      box-shadow: 0 4px 14px #2792c355;
    }
    .profile-details {
      margin-top: 12px;
      font-size: 1.07rem;
    }
    ul.announcements-list {
      margin: 0 0 0 15px;
      padding: 0;
      font-size: 1.08rem;
    }
    ul.announcements-list li {
      margin-bottom: 6px;
      line-height: 1.33;
    }
    .hire-form label {
      margin-bottom: 13px;
    }
    .form-message {
      margin-top: 10px;
      font-size: 1.03rem;
      color: #1eae60;
      font-weight: 600;
    }
    .profile-header {
      display: flex;
      align-items: center;
      gap: 22px;
      margin-bottom: 10px;
    }
    .profile-header h3 {
      margin: 0;
      font-size: 1.27rem;
      font-family: 'Montserrat', Arial, sans-serif;
      color: #04786f;
    }
    .profile-logout-btn {
      background: #b3f6ea;
      color: #04786f;
      border: none;
      border-radius: 7px;
      font-size: 1rem;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 700;
      padding: 8px 15px;
      cursor: pointer;
      margin-left: auto;
    }
    .profile-info {
      font-size: 1.08rem;
      margin-bottom: 10px;
    }
    .profile-info ul {
      margin: 4px 0 0 20px;
      padding: 0;
      font-size: 1rem;
    }
    #shift-control-block {
      margin-top: 13px;
      margin-bottom: 12px;
    }
    .shift-buttons {
      display: flex;
      gap: 13px;
      margin: 10px 0;
    }
    #shift-status {
      margin-top: 7px;
      font-size: 1.01rem;
      color: #1eae60;
    }
    .profile-history-scroll {
      max-height: 210px;
      overflow-y: auto;
      border-radius: 10px;
      background: #f6f9fa;
      box-shadow: 0 1px 8px 0 rgba(80,90,110,0.07);
      padding: 17px 14px;
      margin-top: 8px;
    }
    .shift-history-block {
      margin-bottom: 13px;
      background: #e6fefb;
      padding: 13px 12px 8px 12px;
      border-radius: 8px;
      font-size: 1rem;
      box-shadow: 0 1px 5px #b3f6ea55;
    }
    .shift-history-block b { color: #1976d2; }
    .shift-history-block ul {
      margin: 3px 0 0 0;
      padding-left: 18px;
      font-size: 0.99rem;
    }
    .shift-history-block li { margin-bottom: 2px; }
    .cal-row {
      display: flex;
    }
    .cal-cell {
      min-width: 96px;
      min-height: 40px;
      border-bottom: 1px solid #e4eaf2;
      border-right: 1px solid #e4eaf2;
      position: relative;
      background: #fafdff;
    }
    .cal-cell.cal-time {
      min-width: 56px;
      background: #f6f9fa;
      color: #888;
      font-size: 0.98rem;
      text-align: right;
      padding-right: 5px;
      border-right: 1px solid #e4eaf2;
    }
    .cal-row.cal-header .cal-cell {
      background: #f3f6fb;
      color: #1976d2;
      font-weight: 700;
      font-size: 1rem;
      border-bottom: 2px solid #c3a3fc;
    }
    .cal-row .cal-cell:last-child { border-right: none; }
    .cal-row:last-child .cal-cell { border-bottom: none; }
    .cal-event-block {
      position: absolute;
      left: 7px;
      right: 7px;
      z-index: 2;
      display: flex;
      align-items: center;
      padding-left: 7px;
      border-radius: 7px;
      background: #ffb347;
      color: #333;
      font-size: 0.98rem;
      box-shadow: 0 1px 5px #8883;
      min-height: 38px;
      max-width: 100%;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .admin-cal-event {
      font-size: 1.04rem;
      margin-bottom: 13px;
    }
    .admin-cal-event .admin-cal-edit-btn,
    .admin-cal-event .admin-cal-delete-btn {
      margin-left: 10px;
      font-size: 0.94rem;
      background: #ffe082;
      color: #7e46c5;
      padding: 3px 13px;
      border-radius: 7px;
      border: none;
      font-weight: 700;
      cursor: pointer;
    }
    .admin-worker-block .edit-worker-btn,
    .admin-worker-block .delete-worker-btn {
      margin-left: 8px;
      font-size: 0.94rem;
      background: #c3a3fc;
      color: #7e46c5;
      padding: 3px 13px;
      border-radius: 7px;
      border: none;
      font-weight: 700;
      cursor: pointer;
    }
    .admin-worker-block .admin-worker-tasks {
      margin-top: 5px;
      margin-bottom: 8px;
      font-size: 0.98rem;
    }
    .edit-worker-form, .admin-cal-edit-form {
      margin-top: 7px;
      padding: 8px 3px;
      background: #fafdff;
      border-radius: 7px;
      box-shadow: 0 1px 4px #8881;
      font-size: 1rem;
    }
    .edit-worker-form input, .admin-cal-edit-form input, .admin-cal-edit-form select {
      max-width: 180px;
    }
    #admin-profile-passwords {
      display: flex;
      flex-direction: column;
      gap: 11px;
      margin-top: 10px;
    }
    @media(max-width: 950px) {
      .menu-squares { gap: 12px; }
      .menu-square { width: 130px; height: 130px; font-size: 0.97rem;}
      .details-section { padding: 18px 8px; }
    }
    @media(max-width: 700px) {
      .menu-squares { flex-direction: column; gap: 13px; }
      .details-section { padding: 8px 2vw; }
      .profile-history-scroll { padding: 7px 4px; }
    }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="menu-squares">
      <div class="menu-square orange-gradient" id="shifts-square">Shifts &amp; Workers</div>
      <div class="menu-square blue-gradient" id="announcements-square">Announcements</div>
      <div class="menu-square green-gradient" id="hire-square">Apply / Hire</div>
      <div class="menu-square purple-gradient" id="admin-square">Admin Panel</div>
      <div class="menu-square calendar-gradient" id="calendar-square">Calendar</div>
      <div class="menu-square profile-gradient" id="profile-square">My Profile</div>
    </div>
    <div id="shifts-details" class="details-section hidden">
      <h2>Shifts &amp; Workers</h2>
      <div class="shift-squares" id="shift-squares"></div>
      <div class="profile-details" id="profile-details"><h3>Click a profile to see shift details</h3></div>
    </div>
    <div id="announcements-details" class="details-section hidden">
      <h2>Announcements</h2>
      <ul class="announcements-list" id="announcements-list"></ul>
    </div>
    <div id="hire-details" class="details-section hidden">
      <h2>Apply for a Position</h2>
      <form id="hire-form" class="hire-form">
        <label>Full Name: <input name="name" required></label>
        <label>Email: <input name="email" type="email" required></label>
        <label>Phone: <input name="phone" required></label>
        <label>Why do you want this job? <textarea name="why" required></textarea></label>
        <label>Relevant experience: <textarea name="experience"></textarea></label>
        <label>Greatest strength: <input name="strengths" required></label>
        <label>Biggest weakness: <input name="weaknesses" required></label>
        <label>Availability: <input name="availability" required></label>
        <label>Preferred shift: <input name="shift"></label>
        <label>Willing to work weekends? <select name="weekends">
          <option>No</option><option>Yes</option>
        </select></label>
        <label>Describe a challenge you overcame: <textarea name="challenge"></textarea></label>
        <label>Emergency contact: <input name="emergency"></label>
        <button type="submit">Submit Application</button>
      </form>
      <div class="form-message" id="form-message"></div>
    </div>
    <div id="calendar-details" class="details-section hidden">
      <h2>Weekly Calendar</h2>
      <div style="display:flex;align-items:center;gap:16px;margin-bottom:12px;">
        <button id="calendar-prev-btn" title="Previous Week">&lt;</button>
        <button id="calendar-today-btn" title="Today">Today</button>
        <span id="calendar-week-label" style="font-weight:700;font-size:1.15em;"></span>
        <button id="calendar-next-btn" title="Next Week">&gt;</button>
      </div>
      <div id="calendar-grid" style="overflow-x:auto;background:#fafdff;border-radius:10px;box-shadow:0 1px 8px #8881;padding:7px 2px;"></div>
    </div>
    <div id="admin-details" class="details-section hidden">
      <h2>Admin Panel</h2>
      <div id="admin-login">
        <label>Admin Code: <input type="password" id="admin-code" autocomplete="off"></label>
        <button id="admin-login-btn">Login</button>
        <span id="admin-login-message" style="color:#b32d2d;margin-left:11px;"></span>
      </div>
      <div id="admin-panel" class="hidden">
        <div class="admin-section">
          <h3>Manage Workers</h3>
          <div id="admin-workers-list"></div>
          <button id="add-worker-btn">Add Worker</button>
          <div id="add-worker-form" class="hidden" style="margin-top:14px;">
            <label>Name: <input type="text" id="new-worker-name"></label>
            <label>Shift: <input type="text" id="new-worker-shift"></label>
            <label>Tasks (comma separated): <input type="text" id="new-worker-tasks"></label>
            <button id="save-new-worker-btn">Save</button>
            <button id="cancel-new-worker-btn">Cancel</button>
          </div>
        </div>
        <div class="admin-section">
          <h3>Announcements</h3>
          <ul id="admin-announcements-list"></ul>
          <input type="text" id="admin-new-announcement" placeholder="New announcement" style="width:60%;">
          <button id="admin-add-announcement-btn">Add</button>
        </div>
        <div class="admin-section">
          <h3>Calendar Events</h3>
          <div id="admin-calendar-list"></div>
          <form id="admin-add-calendar-form" style="margin-top:10px;">
            <label>Title: <input id="admin-cal-title" required></label>
            <label>Day: <select id="admin-cal-day">
              <option value="0">Monday</option>
              <option value="1">Tuesday</option>
              <option value="2">Wednesday</option>
              <option value="3">Thursday</option>
              <option value="4">Friday</option>
              <option value="5">Saturday</option>
              <option value="6">Sunday</option>
            </select></label>
            <label>Start Time: <input type="time" id="admin-cal-start" required></label>
            <label>End Time: <input type="time" id="admin-cal-end" required></label>
            <label>Color: <input type="color" id="admin-cal-color" value="#ffb347"></label>
            <button type="submit">Add Event</button>
          </form>
        </div>
        <div class="admin-section">
          <h3>Applications</h3>
          <div id="submissions-list"></div>
        </div>
        <div class="admin-section">
          <h3>Change Admin Code</h3>
          <input type="password" id="new-admin-code" placeholder="New admin code" style="max-width:180px;">
          <button id="change-admin-code-btn">Change Code</button>
          <span id="admin-code-message" style="margin-left:13px;"></span>
        </div>
        <div class="admin-section">
          <h3>Manage Profiles</h3>
          <div id="admin-profile-passwords"></div>
        </div>
      </div>
    </div>
    <div id="profile-details-section" class="details-section hidden">
      <div id="profile-login-section">
        <h2>My Profile</h2>
        <form id="profile-login-form">
          <label>Username: <input type="text" id="profile-login-username" autocomplete="username"></label>
          <label>Password: <input type="password" id="profile-login-password" autocomplete="current-password"></label>
          <button type="submit">Login</button>
        </form>
        <div id="profile-login-message" style="color:#b32d2d;margin-top:7px;"></div>
      </div>
      <div id="profile-main-section" class="hidden">
        <div class="profile-header">
          <h3 id="profile-name"></h3>
          <button id="profile-logout-btn" class="profile-logout-btn">Logout</button>
        </div>
        <div class="profile-info">
          <div><b>Schedule:</b> <span id="profile-schedule"></span></div>
          <div><b>Lunch Break:</b> <span id="profile-lunch"></span></div>
          <div>
            <b>Past Jobs:</b>
            <ul id="profile-history-list"></ul>
          </div>
        </div>
        <div id="shift-control-block">
          <div><b>Current Shift:</b> <span id="profile-current-shift"></span></div>
          <div class="shift-buttons">
            <button id="clock-in-btn">Clock In</button>
            <button id="start-break-btn" disabled>Start Break</button>
            <button id="end-break-btn" disabled>End Break</button>
            <button id="clock-out-btn" disabled>Clock Out</button>
          </div>
          <div id="shift-status"></div>
        </div>
        <div>
          <b>Shift History</b>
          <div class="profile-history-scroll" id="profile-shift-history"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
// ========== DATA HELPERS ==========

function getProfiles() {
  return JSON.parse(localStorage.getItem("profiles") || '{}');
}
function setProfiles(profiles) {
  localStorage.setItem("profiles", JSON.stringify(profiles));
}
function getWorkers() {
  return JSON.parse(localStorage.getItem("workers") || '[]');
}
function setWorkers(workers) {
  localStorage.setItem("workers", JSON.stringify(workers));
}
function getAnnouncements() {
  return JSON.parse(localStorage.getItem("announcements") || '[]');
}
function setAnnouncements(announcements) {
  localStorage.setItem("announcements", JSON.stringify(announcements));
}
function getCalendarEvents() {
  return JSON.parse(localStorage.getItem("calendarEvents") || '[]');
}
function setCalendarEvents(events) {
  localStorage.setItem("calendarEvents", JSON.stringify(events));
}
function getAdminCode() {
  return localStorage.getItem("adminCode") || "admin123";
}
function setAdminCode(code) {
  localStorage.setItem("adminCode", code);
}
function getSubmissions() {
  return JSON.parse(localStorage.getItem("submissions") || '[]');
}
function setSubmissions(subs) {
  localStorage.setItem("submissions", JSON.stringify(subs));
}

// ========== INITIAL DEMO DATA (ON FIRST LOAD) ==========

if (!localStorage.getItem("INITIALIZED")) {
  // Demo workers
  setWorkers([
    { name: "John Doe", shift: "9:00 - 17:00", tasks: ["Inventory", "Cashier"] },
    { name: "Jane Smith", shift: "13:00 - 21:00", tasks: ["Stock", "Customer Support"] }
  ]);
  // Demo profiles
  setProfiles({
    john: {
      username: "john",
      name: "John Doe",
      schedule: "Mon-Fri 9:00 - 17:00",
      lunch: "12:00-12:30",
      password: "johnpass",
      jobs: [
        { title: "Inventory", duration: "3mo", hours: "120", lunch: "yes" },
        { title: "Cashier", duration: "8mo", hours: "320", lunch: "yes" }
      ],
      history: [
        { date: "2025-06-01", clockIn: "09:01", clockOut: "17:00" },
        { date: "2025-06-02", clockIn: "09:00", clockOut: "17:12" }
      ]
    },
    jane: {
      username: "jane",
      name: "Jane Smith",
      schedule: "Mon-Fri 13:00 - 21:00",
      lunch: "16:00-16:30",
      password: "janepass",
      jobs: [
        { title: "Stock", duration: "2mo", hours: "80", lunch: "yes" }
      ],
      history: [
        { date: "2025-06-01", clockIn: "13:05", clockOut: "20:59" }
      ]
    }
  });
  // Demo announcements
  setAnnouncements([
    "Staff meeting Friday at 4pm.",
    "Remember to submit time sheets by Monday."
  ]);
  // Demo calendar events
  setCalendarEvents([
    { id: 1, title: "Morning Shift", day: 0, start: "09:00", end: "13:00", color: "#ffb347" },
    { id: 2, title: "Afternoon Shift", day: 0, start: "13:00", end: "17:00", color: "#71c7ec" }
  ]);
  setAdminCode("admin123");
  setSubmissions([]);
  localStorage.setItem("INITIALIZED", "yes");
}

// ========== MENU NAVIGATION ==========

const sectionIDs = [
  "shifts-details","announcements-details","hire-details",
  "calendar-details","admin-details","profile-details-section"
];
const squareIDs = [
  "shifts-square","announcements-square","hire-square",
  "calendar-square","admin-square","profile-square"
];
squareIDs.forEach((id, idx) => {
  document.getElementById(id).onclick = () => {
    sectionIDs.forEach((sec,i) => {
      document.getElementById(sec).classList.toggle("hidden", i!==idx);
    });
    // Deselect all squares, select this
    squareIDs.forEach(sid => document.getElementById(sid).classList.remove("selected"));
    document.getElementById(id).classList.add("selected");
    // Render when showing
    if(secIDs[idx]==="shifts-details") renderWorkers();
    if(secIDs[idx]==="announcements-details") renderAnnouncements();
    if(secIDs[idx]==="calendar-details") renderCalendar();
    if(secIDs[idx]==="profile-details-section") renderProfileLogin();
    if(secIDs[idx]==="admin-details") showAdminLoginOrPanel();
  };
});
const secIDs = sectionIDs; // alias for brevity

// ========== SHIFTS & WORKERS ==========

function renderWorkers() {
  const workers = getWorkers();
  const el = document.getElementById('shift-squares');
  el.innerHTML = '';
  workers.forEach((w,i) => {
    const div = document.createElement("div");
    div.className = "shift-square";
    div.innerHTML = `<b>${w.name}</b><br><span style="font-weight:400;">${w.shift}</span>`;
    div.onclick = () => renderWorkerDetails(w);
    el.appendChild(div);
  });
  document.getElementById("profile-details").innerHTML = "<h3>Click a profile to see shift details</h3>";
}
function renderWorkerDetails(worker) {
  const el = document.getElementById("profile-details");
  el.innerHTML = `<div>
    <h3>${worker.name}</h3>
    <div><b>Shift:</b> ${worker.shift}</div>
    <div><b>Tasks:</b> ${worker.tasks.join(", ")}</div>
  </div>`;
}

// ========== ANNOUNCEMENTS ==========

function renderAnnouncements() {
  const ann = getAnnouncements();
  const ul = document.getElementById("announcements-list");
  ul.innerHTML = ann.map(a=>`<li>${a}</li>`).join('');
}

// ========== HIRE FORM ==========

document.getElementById("hire-form").onsubmit = function(e){
  e.preventDefault();
  const sub = {};
  Array.from(this.elements).forEach(f=>{
    if(f.name) sub[f.name]=f.value;
  });
  const subs = getSubmissions();
  subs.push(sub);
  setSubmissions(subs);
  document.getElementById("form-message").textContent = "Thank you! Application submitted.";
  this.reset();
  setTimeout(()=>{document.getElementById("form-message").textContent="";},1500);
}

// ========== CALENDAR ==========

let calendarBaseDate = null; // Monday of displayed week

function getMonday(d) {
  d = new Date(d);
  const day = d.getDay(), diff = d.getDate() - day + (day === 0 ? -6:1);
  return new Date(d.setDate(diff));
}
function renderCalendar(baseDate) {
  if(!baseDate) baseDate = getMonday(new Date());
  calendarBaseDate = baseDate;
  const week = [];
  for(let i=0;i<7;i++) {
    const d = new Date(baseDate);
    d.setDate(baseDate.getDate()+i);
    week.push(d);
  }
  document.getElementById("calendar-week-label").textContent =
    week[0].toDateString() + " - " + week[6].toDateString();
  const grid = document.getElementById("calendar-grid");
  const events = getCalendarEvents();
  // Header
  let html = `<div class="cal-row cal-header">
    <div class="cal-cell cal-time"></div>
    ${week.map(d=>`<div class="cal-cell">${d.toLocaleDateString('en-US', {weekday:'short'})}<br>${d.getMonth()+1}/${d.getDate()}</div>`).join('')}
  </div>`;
  // 14 time slots 7:00-20:00
  for(let h=7;h<21;h++) {
    html += `<div class="cal-row">
      <div class="cal-cell cal-time">${h}:00</div>
      ${week.map((d,dayIdx)=>{
        const evs = events.filter(ev=>ev.day==dayIdx && +ev.start.split(":")[0]<=h && +ev.end.split(":")[0]>h);
        return `<div class="cal-cell" style="position:relative;">${
          evs.map(ev=>`<div class="cal-event-block" style="background:${ev.color}">${ev.title} (${ev.start}-${ev.end})</div>`).join('')
        }</div>`;
      }).join('')}
    </div>`;
  }
  grid.innerHTML = html;
}
document.getElementById("calendar-prev-btn").onclick = ()=>{
  calendarBaseDate.setDate(calendarBaseDate.getDate()-7);
  renderCalendar(calendarBaseDate);
};
document.getElementById("calendar-next-btn").onclick = ()=>{
  calendarBaseDate.setDate(calendarBaseDate.getDate()+7);
  renderCalendar(calendarBaseDate);
};
document.getElementById("calendar-today-btn").onclick = ()=>{
  renderCalendar(getMonday(new Date()));
};

// ========== PROFILE LOGIN & MAIN SECTION ==========

let currentProfileKey = null;
function renderProfileLogin(){
  document.getElementById("profile-login-section").classList.remove("hidden");
  document.getElementById("profile-main-section").classList.add("hidden");
  document.getElementById("profile-login-form").reset();
  document.getElementById("profile-login-message").textContent = "";
}
document.getElementById("profile-login-form").onsubmit = function(e){
  e.preventDefault();
  const uname = document.getElementById("profile-login-username").value.trim();
  const pass = document.getElementById("profile-login-password").value;
  const profiles = getProfiles();
  for(const key in profiles) {
    if(profiles[key].username===uname && profiles[key].password===pass) {
      currentProfileKey = key;
      renderProfileMain();
      return;
    }
  }
  document.getElementById("profile-login-message").textContent = "Invalid credentials.";
};
function renderProfileMain(){
  const profile = getProfiles()[currentProfileKey];
  document.getElementById("profile-login-section").classList.add("hidden");
  document.getElementById("profile-main-section").classList.remove("hidden");
  document.getElementById("profile-name").textContent = profile.name;
  document.getElementById("profile-schedule").textContent = profile.schedule||"-";
  document.getElementById("profile-lunch").textContent = profile.lunch||"-";
  // Past jobs
  document.getElementById("profile-history-list").innerHTML = 
    (profile.jobs||[]).map(j=>`<li>${j.title||""} (${j.duration||""}, hours: ${j.hours||"-"}, lunch: ${j.lunch||"-"})</li>`).join('');
  // Shift history
  renderProfileShiftHistory();
  document.getElementById("profile-current-shift").textContent = "- (not implemented)";
  document.getElementById("shift-status").textContent = "";
  // Buttons (for demo, only clock-in enabled)
  document.getElementById("clock-in-btn").disabled = false;
  document.getElementById("start-break-btn").disabled = true;
  document.getElementById("end-break-btn").disabled = true;
  document.getElementById("clock-out-btn").disabled = true;
}
function renderProfileShiftHistory(){
  const profile = getProfiles()[currentProfileKey];
  const div = document.getElementById("profile-shift-history");
  div.innerHTML = (profile.history||[]).slice(-10).reverse().map(h=>
    `<div class="shift-history-block">
      <b>${h.date}</b>: ${h.clockIn||"-"} — ${h.clockOut||"-"}
    </div>`).join('');
}
document.getElementById("profile-logout-btn").onclick = function(){
  currentProfileKey = null;
  renderProfileLogin();
};

// ========== ADMIN PANEL & CRUD FOR PROFILES ==========

function showAdminLoginOrPanel(){
  if(localStorage.getItem("ADMIN_LOGGED_IN")==="yes"){
    document.getElementById("admin-login").classList.add("hidden");
    document.getElementById("admin-panel").classList.remove("hidden");
    renderAdminWorkers();
    renderAdminAnnouncements();
    renderAdminCalendar();
    renderAdminSubmissions();
    renderAdminProfilePasswords();
  } else {
    document.getElementById("admin-login").classList.remove("hidden");
    document.getElementById("admin-panel").classList.add("hidden");
  }
}
document.getElementById("admin-login-btn").onclick = function(){
  const code = document.getElementById("admin-code").value;
  if(code===getAdminCode()){
    localStorage.setItem("ADMIN_LOGGED_IN","yes");
    showAdminLoginOrPanel();
    document.getElementById("admin-login-message").textContent = "";
  } else {
    document.getElementById("admin-login-message").textContent = "Invalid!";
  }
};
function adminLogout(){
  localStorage.removeItem("ADMIN_LOGGED_IN");
  showAdminLoginOrPanel();
}
document.getElementById("profile-logout-btn").onclick = adminLogout;

function renderAdminWorkers() {
  const workers = getWorkers();
  const el = document.getElementById("admin-workers-list");
  el.innerHTML = workers.map((w,i)=>`
    <div class="admin-worker-block">
      <b>${w.name}</b> — Shift: ${w.shift}
      <div class="admin-worker-tasks">Tasks: ${(w.tasks||[]).join(", ")}</div>
      <button class="edit-worker-btn" data-i="${i}">Edit</button>
      <button class="delete-worker-btn" data-i="${i}">Delete</button>
    </div>
  `).join('');
}
document.getElementById("add-worker-btn").onclick = function(){
  document.getElementById("add-worker-form").classList.remove("hidden");
};
document.getElementById("cancel-new-worker-btn").onclick = function(){
  document.getElementById("add-worker-form").classList.add("hidden");
};
document.getElementById("save-new-worker-btn").onclick = function(){
  const name = document.getElementById("new-worker-name").value.trim();
  const shift = document.getElementById("new-worker-shift").value.trim();
  const tasks = document.getElementById("new-worker-tasks").value.split(",").map(t=>t.trim()).filter(Boolean);
  if(!name || !shift) return alert("Name and shift required!");
  const workers = getWorkers();
  workers.push({name,shift,tasks});
  setWorkers(workers);
  renderAdminWorkers();
  document.getElementById("add-worker-form").classList.add("hidden");
  document.getElementById("new-worker-name").value = "";
  document.getElementById("new-worker-shift").value = "";
  document.getElementById("new-worker-tasks").value = "";
};
document.getElementById("admin-workers-list").onclick = function(e){
  if(e.target.classList.contains("delete-worker-btn")){
    const i = +e.target.getAttribute("data-i");
    if(confirm("Delete worker?")){
      const workers = getWorkers();
      workers.splice(i,1);
      setWorkers(workers);
      renderAdminWorkers();
    }
  }
  if(e.target.classList.contains("edit-worker-btn")){
    const i = +e.target.getAttribute("data-i");
    const workers = getWorkers();
    const w = workers[i];
    document.getElementById("add-worker-form").classList.remove("hidden");
    document.getElementById("new-worker-name").value = w.name;
    document.getElementById("new-worker-shift").value = w.shift;
    document.getElementById("new-worker-tasks").value = (w.tasks||[]).join(", ");
    document.getElementById("save-new-worker-btn").onclick = function(){
      w.name = document.getElementById("new-worker-name").value.trim();
      w.shift = document.getElementById("new-worker-shift").value.trim();
      w.tasks = document.getElementById("new-worker-tasks").value.split(",").map(t=>t.trim()).filter(Boolean);
      if(!w.name||!w.shift) return alert("Name and shift required!");
      workers[i]=w;
      setWorkers(workers);
      renderAdminWorkers();
      document.getElementById("add-worker-form").classList.add("hidden");
      document.getElementById("new-worker-name").value = "";
      document.getElementById("new-worker-shift").value = "";
      document.getElementById("new-worker-tasks").value = "";
      document.getElementById("save-new-worker-btn").onclick = saveNewWorkerBtnOrig;
    };
  }
};
const saveNewWorkerBtnOrig = document.getElementById("save-new-worker-btn").onclick;

// Announcements
function renderAdminAnnouncements() {
  const ann = getAnnouncements();
  const ul = document.getElementById("admin-announcements-list");
  ul.innerHTML = ann.map((a,i)=>`<li>${a} <button class="del-ann-btn" data-i="${i}">Delete</button></li>`).join('');
}
document.getElementById("admin-add-announcement-btn").onclick = function(){
  const txt = document.getElementById("admin-new-announcement").value.trim();
  if(!txt) return;
  const ann = getAnnouncements();
  ann.push(txt);
  setAnnouncements(ann);
  renderAdminAnnouncements();
  document.getElementById("admin-new-announcement").value = "";
};
document.getElementById("admin-announcements-list").onclick = function(e){
  if(e.target.classList.contains("del-ann-btn")){
    const i = +e.target.getAttribute("data-i");
    const ann = getAnnouncements();
    ann.splice(i,1);
    setAnnouncements(ann);
    renderAdminAnnouncements();
  }
};

// Calendar events
function renderAdminCalendar() {
  const events = getCalendarEvents();
  const el = document.getElementById("admin-calendar-list");
  el.innerHTML = events.map((ev,i)=>`
    <div class="admin-cal-event">
      <b>${ev.title}</b> — ${["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][ev.day]} ${ev.start}-${ev.end}
      <span style="background:${ev.color};display:inline-block;width:19px;height:12px;vertical-align:middle;border-radius:5px;margin-left:5px;"></span>
      <button class="admin-cal-delete-btn" data-i="${i}">Delete</button>
    </div>
  `).join('');
}
document.getElementById("admin-add-calendar-form").onsubmit = function(e){
  e.preventDefault();
  const title = document.getElementById("admin-cal-title").value.trim();
  const day = +document.getElementById("admin-cal-day").value;
  const start = document.getElementById("admin-cal-start").value;
  const end = document.getElementById("admin-cal-end").value;
  const color = document.getElementById("admin-cal-color").value;
  if(!title||!start||!end) return alert("Title and times required!");
  const evs = getCalendarEvents();
  evs.push({ id:Date.now(), title, day, start, end, color });
  setCalendarEvents(evs);
  renderAdminCalendar();
  this.reset();
};
document.getElementById("admin-calendar-list").onclick = function(e){
  if(e.target.classList.contains("admin-cal-delete-btn")){
    const i = +e.target.getAttribute("data-i");
    const evs = getCalendarEvents();
    evs.splice(i,1);
    setCalendarEvents(evs);
    renderAdminCalendar();
  }
};

// Applications
function renderAdminSubmissions() {
  const subs = getSubmissions();
  const el = document.getElementById("submissions-list");
  el.innerHTML = subs.map((s,i)=>`
    <div class="submission-block">
      <b>${s.name||"-"}</b> (${s.email||"-"})<br>
      <b>Phone:</b> ${s.phone||"-"}<br>
      <b>Why:</b> ${s.why||"-"}<br>
      <b>Experience:</b> ${s.experience||"-"}<br>
      <b>Strengths:</b> ${s.strengths||"-"}<br>
      <b>Weaknesses:</b> ${s.weaknesses||"-"}<br>
      <b>Availability:</b> ${s.availability||"-"}<br>
      <b>Preferred shift:</b> ${s.shift||"-"}<br>
      <b>Weekends:</b> ${s.weekends||"-"}<br>
      <b>Challenge:</b> ${s.challenge||"-"}<br>
      <b>Emergency:</b> ${s.emergency||"-"}
      <button class="del-sub-btn" data-i="${i}" style="float:right;">Delete</button>
    </div>
  `).join('');
}
document.getElementById("submissions-list").onclick = function(e){
  if(e.target.classList.contains("del-sub-btn")){
    const i = +e.target.getAttribute("data-i");
    const subs = getSubmissions();
    subs.splice(i,1);
    setSubmissions(subs);
    renderAdminSubmissions();
  }
};

// Admin code change
document.getElementById("change-admin-code-btn").onclick = function(){
  const code = document.getElementById("new-admin-code").value.trim();
  if(code.length<3){
    document.getElementById("admin-code-message").textContent = "Must be 3+ chars";
    return;
  }
  setAdminCode(code);
  document.getElementById("admin-code-message").textContent = "Changed!";
  setTimeout(()=>{document.getElementById("admin-code-message").textContent="";},1200);
  document.getElementById("new-admin-code").value = "";
};

// ========== ADMIN PROFILE FULL CRUD ==========

function renderAdminProfilePasswords() {
  const profiles = getProfiles();
  const container = document.getElementById('admin-profile-passwords');
  container.innerHTML = '';

  // Add button for creating a new profile
  const addBtn = document.createElement('button');
  addBtn.textContent = "Add New Profile";
  addBtn.style = "background:#1976d2;color:white;font-weight:700;margin-bottom:18px;";
  addBtn.onclick = () => showAdminNewProfileForm();
  container.appendChild(addBtn);

  // Add form for new profile (hidden by default)
  const newFormDiv = document.createElement('div');
  newFormDiv.id = "admin-new-profile-form";
  newFormDiv.style.display = "none";
  newFormDiv.innerHTML = `
    <form class="admin-new-profile-form" style="margin-top:15px;background:#fafdff;padding:14px 14px 12px 14px;border-radius:9px;box-shadow:0 1px 4px #8881;">
      <label>Username: <input type="text" class="admin-new-username" required></label>
      <label>Name: <input type="text" class="admin-new-name" required></label>
      <label>Schedule: <input type="text" class="admin-new-schedule"></label>
      <label>Lunch Break: <input type="text" class="admin-new-lunch"></label>
      <label>Password: <input type="password" class="admin-new-password" required></label>
      <label>
        Past Jobs:
        <textarea class="admin-new-jobs" rows="3" placeholder="title|duration|hours|lunch, one per line"></textarea>
        <span style="font-size:0.95em;color:#888;">Format: title|duration|hours|lunch (each job on a new line)</span>
      </label>
      <button type="submit" style="background:#1eae60;color:white;font-weight:700;">Create Profile</button>
      <button type="button" class="admin-new-cancel-btn" style="background:#d32f2f;color:white;font-weight:700;margin-left:10px;">Cancel</button>
    </form>
    <div class="admin-new-profile-feedback" style="color:#d32f2f;margin-top:7px;"></div>
  `;
  container.appendChild(newFormDiv);

  // Render existing profiles
  Object.keys(profiles).forEach(key => {
    const user = profiles[key];
    const jobsString = (user.jobs && user.jobs.length)
      ? user.jobs.map(j => `${j.title || ""}|${j.duration || ""}|${j.hours || ""}|${j.lunch || ""}`).join('\n')
      : '';
    const div = document.createElement('div');
    div.className = "admin-profile-edit-block";
    div.style.marginBottom = "22px";
    div.innerHTML = `
      <b>${user.name}</b> (<i>${user.username}</i>)
      <form class="admin-edit-profile-form" data-key="${key}" style="margin-top:8px;background:#fafdff;padding:14px 14px 12px 14px;border-radius:9px;box-shadow:0 1px 4px #8881;">
        <label>Username: <input type="text" class="admin-profile-username" value="${user.username}" required></label>
        <label>Name: <input type="text" class="admin-profile-name" value="${user.name}" required></label>
        <label>Schedule: <input type="text" class="admin-profile-schedule" value="${user.schedule || ""}"></label>
        <label>Lunch Break: <input type="text" class="admin-profile-lunch" value="${user.lunch || ""}"></label>
        <label>Password: <input type="password" class="admin-profile-password" placeholder="Leave blank to keep current"></label>
        <label>
          Past Jobs:
          <textarea class="admin-profile-jobs" rows="3" placeholder="title|duration|hours|lunch, one per line">${jobsString}</textarea>
          <span style="font-size:0.95em;color:#888;">Format: title|duration|hours|lunch (each job on a new line)</span>
        </label>
        <label>
          <b>Delete All Shift History:</b>
          <button type="button" class="admin-profile-history-delete-btn" data-key="${key}" style="background:#d32f2f;color:white;margin-left:7px;">Delete All</button>
        </label>
        <div class="profile-history-preview" style="background:#f6f9fa;border-radius:7px;padding:8px 12px;margin-bottom:8px;">
          <b>Shift History Preview:</b>
          <ul style="margin-top:4px;">
            ${user.history && user.history.length
              ? user.history.slice(0, 5).map(h =>
                `<li>${h.date}: ${h.clockIn || "-"} to ${h.clockOut || "-"}</li>`).join("")
              : "<li><i>No history</i></li>"
            }
          </ul>
        </div>
        <button type="submit" class="admin-profile-save-btn" style="background:#1eae60;color:white;font-weight:700;">Save Profile</button>
        <button type="button" class="admin-profile-delete-btn" data-key="${key}" style="background:#d32f2f;color:white;font-weight:700;margin-left:10px;">Delete Profile</button>
      </form>
      <div class="admin-profile-feedback" style="color:#d32f2f;margin-top:7px;"></div>
    `;
    container.appendChild(div);
  });
}

// Show/hide new profile form
function showAdminNewProfileForm() {
  const formDiv = document.getElementById("admin-new-profile-form");
  formDiv.style.display = "block";
  formDiv.querySelector(".admin-new-profile-form").reset();
  formDiv.querySelector(".admin-new-profile-feedback").textContent = "";
}
function hideAdminNewProfileForm() {
  const formDiv = document.getElementById("admin-new-profile-form");
  formDiv.style.display = "none";
}

// Add new profile
document.getElementById('admin-profile-passwords').addEventListener('submit', function(e) {
  // New profile creation
  if (e.target.classList.contains('admin-new-profile-form')) {
    e.preventDefault();
    const form = e.target;
    const feedback = form.parentNode.querySelector('.admin-new-profile-feedback');
    const username = form.querySelector('.admin-new-username').value.trim();
    const name = form.querySelector('.admin-new-name').value.trim();
    const schedule = form.querySelector('.admin-new-schedule').value.trim();
    const lunch = form.querySelector('.admin-new-lunch').value.trim();
    const password = form.querySelector('.admin-new-password').value;
    const jobsRaw = form.querySelector('.admin-new-jobs').value;
    // Parse jobs
    let jobs = [];
    if (jobsRaw.trim()) {
      jobs = jobsRaw.split(/\n/).map(j=>j.trim()).filter(Boolean)
        .map(str=>{
          let [title, duration, hours, lunch] = str.split('|').map(x=>x && x.trim());
          return { title: title||"", duration: duration||"", hours: hours||"", lunch: lunch||"" };
        });
    }
    // Validate
    if (!username || !name || !password) {
      feedback.textContent = "Username, name, and password are required.";
      return;
    }
    if (password.length < 3) {
      feedback.textContent = "Password must be at least 3 characters.";
      return;
    }
    const profiles = getProfiles();
    for (const k in profiles) {
      if (profiles[k].username === username) {
        feedback.textContent = "Username already exists!";
        return;
      }
    }
    // Generate a unique key
    let key = username.toLowerCase().replace(/[^a-z0-9]/g, '');
    let counter = 1;
    while (profiles[key]) { key = `${username}${counter}`; counter++; }
    profiles[key] = {
      username,
      name,
      schedule,
      lunch,
      password,
      jobs,
      history: []
    };
    setProfiles(profiles);
    hideAdminNewProfileForm();
    renderAdminProfilePasswords();
    alert("New profile created!");
  }
});

// Cancel new profile form
document.getElementById('admin-profile-passwords').addEventListener('click', function(e) {
  if (e.target.classList.contains('admin-new-cancel-btn')) {
    hideAdminNewProfileForm();
  }
});

// Save profile edits
document.getElementById('admin-profile-passwords').addEventListener('submit', function(e) {
  if (e.target.classList.contains('admin-edit-profile-form')) {
    e.preventDefault();
    const form = e.target;
    const key = form.getAttribute('data-key');
    const feedback = form.parentNode.querySelector('.admin-profile-feedback');
    const profiles = getProfiles();
    if (!profiles[key]) return;

    // Get fields
    const username = form.querySelector('.admin-profile-username').value.trim();
    const name = form.querySelector('.admin-profile-name').value.trim();
    const schedule = form.querySelector('.admin-profile-schedule').value.trim();
    const lunch = form.querySelector('.admin-profile-lunch').value.trim();
    const password = form.querySelector('.admin-profile-password').value;
    const jobsRaw = form.querySelector('.admin-profile-jobs').value;
    // Parse jobs
    let jobs = [];
    if (jobsRaw.trim()) {
      jobs = jobsRaw.split(/\n/).map(j=>j.trim()).filter(Boolean)
        .map(str=>{
          let [title, duration, hours, lunch] = str.split('|').map(x=>x && x.trim());
          return { title: title||"", duration: duration||"", hours: hours||"", lunch: lunch||"" };
        });
    }

    // Validate username uniqueness
    if (username !== profiles[key].username) {
      for (const k in profiles) {
        if (k !== key && profiles[k].username === username) {
          feedback.textContent = "Username already exists!";
          return;
        }
      }
    }

    if (!username || !name) {
      feedback.textContent = "Username and name are required.";
      return;
    }

    profiles[key].username = username;
    profiles[key].name = name;
    profiles[key].schedule = schedule;
    profiles[key].lunch = lunch;
    if (password && password.length >= 3) profiles[key].password = password;
    profiles[key].jobs = jobs;

    setProfiles(profiles);
    feedback.textContent = "Profile updated!";
    setTimeout(() => feedback.textContent = "", 1300);
    renderAdminProfilePasswords();
  }
});

// Delete user shift history
document.getElementById('admin-profile-passwords').addEventListener('click', function(e) {
  if (e.target.classList.contains('admin-profile-history-delete-btn')) {
    const key = e.target.getAttribute('data-key');
    if (!confirm("Delete all shift history for this user?")) return;
    const profiles = getProfiles();
    profiles[key].history = [];
    setProfiles(profiles);
    renderAdminProfilePasswords();
  }
});

// Delete profile
document.getElementById('admin-profile-passwords').addEventListener('click', function(e) {
  if (e.target.classList.contains('admin-profile-delete-btn')) {
    const key = e.target.getAttribute('data-key');
    if (!confirm("Delete this profile? This cannot be undone.")) return;
    const profiles = getProfiles();
    delete profiles[key];
    setProfiles(profiles);
    renderAdminProfilePasswords();
    alert("Profile deleted!");
  }
});

// ========== INITIAL RENDERS ==========

// Default: show first menu
(function(){
  sectionIDs.forEach((sec,i) => {
    document.getElementById(sec).classList.toggle("hidden", i!==0);
  });
  squareIDs.forEach((sid,i) => document.getElementById(sid).classList.toggle("selected",i===0));
  renderWorkers();
})();

  </script>
</body>
</html>
