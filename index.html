<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Job Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
  <div class="dashboard">
    <div class="menu-squares">
      <div class="menu-square orange-gradient" id="shifts-square">
        <span>Shifts</span>
      </div>
      <div class="menu-square blue-gradient" id="announcements-square">
        <span>Announcements</span>
      </div>
      <div class="menu-square green-gradient" id="hire-square">
        <span>Apply for Hire</span>
      </div>
      <div class="menu-square purple-gradient" id="admin-square">
        <span>Admin</span>
      </div>
      <div class="menu-square calendar-gradient" id="calendar-square">
        <span>Calendar</span>
      </div>
    </div>

    <!-- Calendar Section -->
    <div class="details-section hidden" id="calendar-details">
      <h2>Weekly Calendar</h2>
      <div class="calendar-container">
        <div class="calendar-table">
          <div class="calendar-header">
            <div class="calendar-cell"></div>
            <div class="calendar-cell">Mon</div>
            <div class="calendar-cell">Tue</div>
            <div class="calendar-cell">Wed</div>
            <div class="calendar-cell">Thu</div>
            <div class="calendar-cell">Fri</div>
            <div class="calendar-cell">Sat</div>
            <div class="calendar-cell">Sun</div>
          </div>
          <div class="calendar-body" id="calendar-body">
            <!-- Calendar rows created by JS -->
          </div>
        </div>
      </div>
    </div>

    <!-- ...existing sections (shifts, announcements, hire, admin) follow here unchanged... -->
    <div class="details-section hidden" id="shifts-details">
      <h2>Shifts</h2>
      <div class="shift-squares" id="shift-squares"></div>
      <div class="profile-details" id="profile-details">
        <h3>Click a profile to see shift details</h3>
      </div>
    </div>
    <div class="details-section hidden" id="announcements-details">
      <h2>Announcements</h2>
      <ul class="announcements-list" id="announcements-list"></ul>
    </div>
    <div class="details-section hidden" id="hire-details">
      <h2>Apply for Hire</h2>
      <form class="hire-form" id="hire-form">
        <label>
          1. Full Name:
          <input type="text" name="name" required>
        </label>
        <label>
          2. Email Address:
          <input type="email" name="email" required>
        </label>
        <label>
          3. Phone Number:
          <input type="text" name="phone" required>
        </label>
        <label>
          4. Why do you want this job?
          <textarea name="why" rows="2" required></textarea>
        </label>
        <label>
          5. What relevant experience do you have?
          <textarea name="experience" rows="2" required></textarea>
        </label>
        <label>
          6. What are your strengths?
          <textarea name="strengths" rows="2" required></textarea>
        </label>
        <label>
          7. What are your weaknesses?
          <textarea name="weaknesses" rows="2" required></textarea>
        </label>
        <label>
          8. What is your availability (days and times)?
          <input type="text" name="availability" required>
        </label>
        <label>
          9. Which shift would you prefer?
          <select name="shift">
            <option>Morning (6am-2pm)</option>
            <option>Day (9am-5pm)</option>
            <option>Evening (1pm-9pm)</option>
          </select>
        </label>
        <label>
          10. Are you willing to work weekends?
          <select name="weekends">
            <option value="yes">Yes</option>
            <option value="no">No</option>
            <option value="maybe">Maybe</option>
          </select>
        </label>
        <label>
          11. Tell us about a time you overcame a challenge:
          <textarea name="challenge" rows="2" required></textarea>
        </label>
        <label>
          12. Emergency Contact Name & Number:
          <input type="text" name="emergency" required>
        </label>
        <button type="submit">Submit Application</button>
        <div class="form-message" id="form-message"></div>
      </form>
    </div>
    <div class="details-section hidden" id="admin-details">
      <h2>Admin Access</h2>
      <div id="admin-login">
        <label>
          Enter admin code:
          <input type="password" id="admin-code" maxlength="32">
        </label>
        <button id="admin-login-btn">Login</button>
        <div id="admin-login-message" style="color: #b32d2d; margin-top: 8px;"></div>
      </div>
      <div id="admin-panel" class="hidden">
        <div class="admin-section">
          <h3>Change Admin Code</h3>
          <label>
            New admin code:
            <input type="password" id="new-admin-code">
          </label>
          <button id="change-admin-code-btn">Change Code</button>
          <div id="admin-code-message" style="margin-top:8px;"></div>
        </div>
        <div class="admin-section">
          <h3>Manage Workers</h3>
          <div id="admin-workers-list"></div>
          <button id="add-worker-btn">Add Worker</button>
          <div id="add-worker-form" class="hidden">
            <label>Name: <input type="text" id="new-worker-name"></label>
            <label>Shift: <input type="text" id="new-worker-shift"></label>
            <label>Tasks (comma separated): <input type="text" id="new-worker-tasks"></label>
            <button id="save-new-worker-btn">Save Worker</button>
            <button id="cancel-new-worker-btn">Cancel</button>
          </div>
        </div>
        <div class="admin-section">
          <h3>Manage Announcements</h3>
          <ul id="admin-announcements-list"></ul>
          <input type="text" id="admin-new-announcement" placeholder="Add announcement">
          <button id="admin-add-announcement-btn">Add</button>
        </div>
        <div class="admin-section">
          <h3>Manage Submissions</h3>
          <div id="submissions-section">
            <div id="submissions-list"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // --- Calendar Data and Rendering ---
    // Example events: start/end in 24h format, day: 0=Mon, 6=Sun
    const calendarEvents = [
      { title: "John Shift", day: 0, start: 9, end: 17, color: "#ffb347" },
      { title: "Jane Shift", day: 1, start: 13, end: 21, color: "#71c7ec" },
      { title: "Bob Shift", day: 2, start: 6, end: 14, color: "#8de7b5" },
      { title: "Team Lunch", day: 4, start: 13, end: 14, color: "#c3a3fc" },
      { title: "Fire Drill", day: 0, start: 10, end: 11, color: "#ff9800" },
      { title: "Manager Meeting", day: 3, start: 15, end: 16.5, color: "#7e46c5" }
    ];
    const hourStart = 6, hourEnd = 21; // 6am to 9pm

    function renderCalendar() {
      const calBody = document.getElementById('calendar-body');
      calBody.innerHTML = '';
      for(let hour = hourStart; hour < hourEnd; hour++) {
        const row = document.createElement('div');
        row.className = 'calendar-row';
        // Time label
        const label = document.createElement('div');
        label.className = 'calendar-cell calendar-time-label';
        label.textContent = (hour < 12 ? hour : (hour === 12 ? 12 : hour-12)) + (hour < 12 ? "am" : "pm");
        row.appendChild(label);
        // Day cells
        for(let day = 0; day < 7; day++) {
          const cell = document.createElement('div');
          cell.className = 'calendar-cell calendar-slot';
          cell.dataset.day = day;
          cell.dataset.hour = hour;
          row.appendChild(cell);
        }
        calBody.appendChild(row);
      }
      // Render events
      calendarEvents.forEach(ev => {
        // For each event, insert a block spanning the right number of hours in the correct column
        const startRow = Math.floor(ev.start) - hourStart;
        const endRow = Math.ceil(ev.end) - hourStart;
        const top = (ev.start - Math.floor(ev.start)) * 40; // 40px per hour
        const height = (ev.end - ev.start) * 40; // 40px per hour
        // Find the cell in the first row for start hour and the correct day
        const allRows = document.querySelectorAll('.calendar-row');
        if (startRow >= 0 && startRow < allRows.length) {
          const cell = allRows[startRow].children[ev.day + 1];
          // Create event block
          const evDiv = document.createElement('div');
          evDiv.className = 'calendar-event-block';
          evDiv.style.top = top + "px";
          evDiv.style.height = height + "px";
          evDiv.style.background = ev.color;
          evDiv.textContent = ev.title;
          // Position absolutely within cell
          cell.style.position = "relative";
          evDiv.style.position = "absolute";
          evDiv.style.left = "2px";
          evDiv.style.right = "2px";
          evDiv.style.zIndex = 2;
          cell.appendChild(evDiv);
          // For multi-hour events, shade background of all spanned cells
          for(let r = startRow+1; r < endRow; r++) {
            if (allRows[r]) {
              const spanCell = allRows[r].children[ev.day + 1];
              spanCell.style.background = "#f7f8ff";
              spanCell.style.position = "relative";
            }
          }
        }
      });
    }

    // --- Data Storage and Defaults ---
    const defaultWorkers = [
      {
        name: "John Doe",
        shift: "9:00 AM - 5:00 PM",
        tasks: [
          "Front desk coverage from 9am-12pm",
          "Inventory check at 2pm",
          "Daily report submission by 4:30pm",
          "Assist with onboarding new employees"
        ]
      },
      {
        name: "Jane Doe",
        shift: "1:00 PM - 9:00 PM",
        tasks: [
          "Supervise afternoon crew",
          "Prepare conference room for meetings",
          "Coordinate with cleaning staff",
          "Update task board at end of shift"
        ]
      },
      {
        name: "Bob Smith",
        shift: "6:00 AM - 2:00 PM",
        tasks: [
          "Early morning inventory restock",
          "Equipment maintenance at 9am",
          "Handle supplier deliveries",
          "Submit maintenance logs by 1:30pm"
        ]
      }
    ];
    const defaultAnnouncements = [
      "Team lunch on Friday at 1pm in the main cafeteria.",
      "Reminder: Submit weekly reports by Thursday 5pm.",
      "Fire drill scheduled for next Monday at 10am."
    ];
    function getAdminCode() {
      return localStorage.getItem('adminCode') || "1234";
    }
    function setAdminCode(newCode) {
      localStorage.setItem('adminCode', newCode);
    }
    function getWorkers() {
      return JSON.parse(localStorage.getItem('workers') || JSON.stringify(defaultWorkers));
    }
    function setWorkers(workers) {
      localStorage.setItem('workers', JSON.stringify(workers));
    }
    function getAnnouncements() {
      return JSON.parse(localStorage.getItem('announcements') || JSON.stringify(defaultAnnouncements));
    }
    function setAnnouncements(list) {
      localStorage.setItem('announcements', JSON.stringify(list));
    }
    function getSubmissions() {
      return JSON.parse(localStorage.getItem('hireSubmissions') || '[]');
    }
    function setSubmissions(subs) {
      localStorage.setItem('hireSubmissions', JSON.stringify(subs));
    }
    function saveSubmission(data) {
      const subs = getSubmissions();
      subs.push(data);
      setSubmissions(subs);
    }

    function renderShiftSquares() {
      const workers = getWorkers();
      const shiftSquares = document.getElementById('shift-squares');
      shiftSquares.innerHTML = '';
      workers.forEach((worker, idx) => {
        const colors = ['orange-gradient', 'blue-gradient', 'green-gradient', 'purple-gradient'];
        const color = colors[idx % colors.length];
        const div = document.createElement('div');
        div.className = `shift-square ${color}`;
        div.innerHTML = `<span>${worker.name}</span>`;
        div.addEventListener('click', () => {
          renderProfileDetails(worker);
        });
        shiftSquares.appendChild(div);
      });
    }
    function renderProfileDetails(worker) {
      const profileDetails = document.getElementById('profile-details');
      profileDetails.innerHTML = `
        <h3>${worker.name}</h3>
        <p><strong>Shift:</strong> ${worker.shift}</p>
        <ul>
          ${worker.tasks.map(task => `<li>${task}</li>`).join('')}
        </ul>
      `;
    }
    function renderAnnouncements() {
      const list = getAnnouncements();
      const annList = document.getElementById('announcements-list');
      annList.innerHTML = '';
      list.forEach(a => {
        const li = document.createElement('li');
        li.textContent = a;
        annList.appendChild(li);
      });
    }
    function renderAdminAnnouncements() {
      const list = getAnnouncements();
      const annList = document.getElementById('admin-announcements-list');
      annList.innerHTML = '';
      list.forEach((a, i) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span class="admin-announcement-text" contenteditable="true" data-idx="${i}">${a}</span>
          <button class="delete-announcement-btn" data-idx="${i}">Delete</button>
        `;
        annList.appendChild(li);
      });
    }
    function renderAdminWorkers() {
      const workers = getWorkers();
      const div = document.getElementById('admin-workers-list');
      div.innerHTML = '';
      workers.forEach((worker, idx) => {
        const workerDiv = document.createElement('div');
        workerDiv.className = "admin-worker-block";
        workerDiv.innerHTML = `
          <b>${worker.name}</b> (<span>${worker.shift}</span>)
          <button class="edit-worker-btn" data-idx="${idx}">Edit</button>
          <button class="delete-worker-btn" data-idx="${idx}">Delete</button>
          <div class="admin-worker-tasks"><ul>${worker.tasks.map(t=>`<li>${t}</li>`).join('')}</ul></div>
          <div class="edit-worker-form hidden" id="edit-worker-form-${idx}">
            <label>Name: <input type="text" value="${worker.name}" class="edit-worker-name"></label>
            <label>Shift: <input type="text" value="${worker.shift}" class="edit-worker-shift"></label>
            <label>Tasks (comma separated): <input type="text" value="${worker.tasks.join(', ')}" class="edit-worker-tasks-input"></label>
            <button class="save-edit-worker-btn" data-idx="${idx}">Save</button>
            <button class="cancel-edit-worker-btn" data-idx="${idx}">Cancel</button>
          </div>
        `;
        div.appendChild(workerDiv);
      });
    }
    function renderAdminSubmissions() {
      const subs = getSubmissions();
      const list = document.getElementById('submissions-list');
      if(subs.length === 0) {
        list.innerHTML = "<em>No submissions yet.</em>";
        return;
      }
      list.innerHTML = subs.map((s, i) => `
        <div class="submission-block">
          <strong>Application #${i+1}</strong>
          <button class="delete-submission-btn" data-idx="${i}">Delete</button>
          <ul>
            <li><b>Full Name:</b> ${s.name}</li>
            <li><b>Email:</b> ${s.email}</li>
            <li><b>Phone:</b> ${s.phone}</li>
            <li><b>Why do you want this job?</b> ${s.why}</li>
            <li><b>Relevant experience:</b> ${s.experience}</li>
            <li><b>Strengths:</b> ${s.strengths}</li>
            <li><b>Weaknesses:</b> ${s.weaknesses}</li>
            <li><b>Availability:</b> ${s.availability}</li>
            <li><b>Preferred shift:</b> ${s.shift}</li>
            <li><b>Willing to work weekends:</b> ${s.weekends}</li>
            <li><b>Challenge overcome:</b> ${s.challenge}</li>
            <li><b>Emergency contact:</b> ${s.emergency}</li>
          </ul>
        </div>
      `).join("");
    }

    // --- Navigation ---
    function hideAllDetails() {
      document.getElementById('shifts-details').classList.add('hidden');
      document.getElementById('announcements-details').classList.add('hidden');
      document.getElementById('hire-details').classList.add('hidden');
      document.getElementById('admin-details').classList.add('hidden');
      document.getElementById('calendar-details').classList.add('hidden');
      document.getElementById('shifts-square').classList.remove('selected');
      document.getElementById('announcements-square').classList.remove('selected');
      document.getElementById('hire-square').classList.remove('selected');
      document.getElementById('admin-square').classList.remove('selected');
      document.getElementById('calendar-square').classList.remove('selected');
    }
    document.getElementById('shifts-square').addEventListener('click', () => {
      hideAllDetails();
      document.getElementById('shifts-details').classList.remove('hidden');
      document.getElementById('shifts-square').classList.add('selected');
      renderShiftSquares();
      document.getElementById('profile-details').innerHTML = `<h3>Click a profile to see shift details</h3>`;
    });
    document.getElementById('announcements-square').addEventListener('click', () => {
      hideAllDetails();
      document.getElementById('announcements-details').classList.remove('hidden');
      document.getElementById('announcements-square').classList.add('selected');
      renderAnnouncements();
    });
    document.getElementById('hire-square').addEventListener('click', () => {
      hideAllDetails();
      document.getElementById('hire-details').classList.remove('hidden');
      document.getElementById('hire-square').classList.add('selected');
    });
    document.getElementById('admin-square').addEventListener('click', () => {
      hideAllDetails();
      document.getElementById('admin-details').classList.remove('hidden');
      document.getElementById('admin-square').classList.add('selected');
      document.getElementById('admin-login').classList.remove('hidden');
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('admin-login-message').textContent = '';
      document.getElementById('admin-code').value = '';
    });
    document.getElementById('calendar-square').addEventListener('click', () => {
      hideAllDetails();
      document.getElementById('calendar-details').classList.remove('hidden');
      document.getElementById('calendar-square').classList.add('selected');
      renderCalendar();
    });

    // --- Hire form submission ---
    document.getElementById('hire-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const data = {};
      for(const [key, value] of formData.entries()) {
        data[key] = value;
      }
      saveSubmission(data);
      document.getElementById('form-message').textContent = "Application submitted! We'll be in touch.";
      form.reset();
      setTimeout(() => {
        document.getElementById('form-message').textContent = "";
      }, 3000);
    });

    // --- Admin login and panel ---
    document.getElementById('admin-login-btn').addEventListener('click', function() {
      const code = document.getElementById('admin-code').value;
      if(code === getAdminCode()) {
        document.getElementById('admin-login').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        renderAdminWorkers();
        renderAdminAnnouncements();
        renderAdminSubmissions();
      } else {
        document.getElementById('admin-login-message').textContent = "Incorrect code.";
      }
    });

    // --- Change admin code ---
    document.getElementById('change-admin-code-btn').addEventListener('click', function() {
      const newCode = document.getElementById('new-admin-code').value.trim();
      if(newCode.length < 3) {
        document.getElementById('admin-code-message').textContent = "Code too short (minimum 3 characters).";
        document.getElementById('admin-code-message').style.color = "#b32d2d";
        return;
      }
      setAdminCode(newCode);
      document.getElementById('admin-code-message').textContent = "Admin code changed!";
      document.getElementById('admin-code-message').style.color = "#1eae60";
      document.getElementById('new-admin-code').value = "";
      setTimeout(() => document.getElementById('admin-code-message').textContent = "", 3000);
    });

    // --- Add Worker ---
    document.getElementById('add-worker-btn').addEventListener('click', function() {
      document.getElementById('add-worker-form').classList.remove('hidden');
      document.getElementById('add-worker-btn').classList.add('hidden');
      document.getElementById('new-worker-name').value = "";
      document.getElementById('new-worker-shift').value = "";
      document.getElementById('new-worker-tasks').value = "";
    });
    document.getElementById('cancel-new-worker-btn').addEventListener('click', function() {
      document.getElementById('add-worker-form').classList.add('hidden');
      document.getElementById('add-worker-btn').classList.remove('hidden');
    });
    document.getElementById('save-new-worker-btn').addEventListener('click', function() {
      const name = document.getElementById('new-worker-name').value.trim();
      const shift = document.getElementById('new-worker-shift').value.trim();
      const tasks = document.getElementById('new-worker-tasks').value.split(',').map(t=>t.trim()).filter(Boolean);
      if(!name || !shift || tasks.length === 0) return;
      const workers = getWorkers();
      workers.push({name, shift, tasks});
      setWorkers(workers);
      renderAdminWorkers();
      renderShiftSquares();
      document.getElementById('add-worker-form').classList.add('hidden');
      document.getElementById('add-worker-btn').classList.remove('hidden');
    });

    // --- Edit/Delete Workers ---
    document.getElementById('admin-workers-list').addEventListener('click', function(e) {
      if(e.target.classList.contains('edit-worker-btn')) {
        const idx = +e.target.dataset.idx;
        document.getElementById(`edit-worker-form-${idx}`).classList.remove('hidden');
      }
      if(e.target.classList.contains('cancel-edit-worker-btn')) {
        const idx = +e.target.dataset.idx;
        document.getElementById(`edit-worker-form-${idx}`).classList.add('hidden');
      }
      if(e.target.classList.contains('save-edit-worker-btn')) {
        const idx = +e.target.dataset.idx;
        const form = document.getElementById(`edit-worker-form-${idx}`);
        const name = form.querySelector('.edit-worker-name').value.trim();
        const shift = form.querySelector('.edit-worker-shift').value.trim();
        const tasks = form.querySelector('.edit-worker-tasks-input').value.split(',').map(t=>t.trim()).filter(Boolean);
        if(!name || !shift || tasks.length === 0) return;
        const workers = getWorkers();
        workers[idx] = {name, shift, tasks};
        setWorkers(workers);
        renderAdminWorkers();
        renderShiftSquares();
      }
      if(e.target.classList.contains('delete-worker-btn')) {
        const idx = +e.target.dataset.idx;
        if(confirm("Delete this worker?")) {
          const workers = getWorkers();
          workers.splice(idx, 1);
          setWorkers(workers);
          renderAdminWorkers();
          renderShiftSquares();
        }
      }
    });

    // --- Admin Announcements ---
    document.getElementById('admin-add-announcement-btn').addEventListener('click', function() {
      const val = document.getElementById('admin-new-announcement').value.trim();
      if(!val) return;
      const list = getAnnouncements();
      list.push(val);
      setAnnouncements(list);
      document.getElementById('admin-new-announcement').value = "";
      renderAdminAnnouncements();
      renderAnnouncements();
    });
    document.getElementById('admin-announcements-list').addEventListener('click', function(e) {
      if(e.target.classList.contains('delete-announcement-btn')) {
        const idx = +e.target.dataset.idx;
        if(confirm("Delete this announcement?")) {
          const list = getAnnouncements();
          list.splice(idx, 1);
          setAnnouncements(list);
          renderAdminAnnouncements();
          renderAnnouncements();
        }
      }
    });
    document.getElementById('admin-announcements-list').addEventListener('blur', function(e) {
      if(e.target.classList.contains('admin-announcement-text')) {
        const idx = +e.target.dataset.idx;
        const list = getAnnouncements();
        list[idx] = e.target.textContent.trim();
        setAnnouncements(list);
        renderAnnouncements();
      }
    }, true);

    // --- Admin Submissions Delete ---
    document.getElementById('submissions-list').addEventListener('click', function(e) {
      if(e.target.classList.contains('delete-submission-btn')) {
        const idx = +e.target.dataset.idx;
        if(confirm("Delete this submission?")) {
          const subs = getSubmissions();
          subs.splice(idx, 1);
          setSubmissions(subs);
          renderAdminSubmissions();
        }
      }
    });

    // --- Initial Render ---
    renderShiftSquares();
    renderAnnouncements();
  </script>
</body>
</html>
